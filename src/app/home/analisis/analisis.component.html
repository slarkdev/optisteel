<main class="main">
  <h1 class="page-title">AnÃ¡lisis</h1>
  <p class="subtitle">
    <!-- <strong> Proyecto: {{ proyectoSeleccionado?.name || ""}} Lote: {{ loteSeleccionado?.NombreTrabajo || "" }}</strong> -->
  </p>

  <div class="ctx" style="justify-content: space-between">
    <div >
      <mat-form-field style="width: 20rem">
        <mat-label>Filtro por Perfil</mat-label>
        <mat-select>
          @for (element of filtroInventarioPiezas; track element) {
          <mat-option [value]="element"
            >{{ element.Perfil }} - {{ element.Calidad }}</mat-option
          >
          }
        </mat-select>
      </mat-form-field>
      <button class="btn btn-ghost-1" (click)="ejecutarNesting()">ðŸ”„ Ejecutar Nesting</button>
    </div>

    <div class="actions">
      <button class="btn btn-ghost-1" (click)="actualizar()">ðŸ”„ Actualizar</button>
      <button class="btn btn-ghost" (click)="limpiar()">ðŸ§¹ Limpiar</button>
      <button class="btn btn-ghost-1" (click)="exportar()">â¤“ Exportar</button>
      <button class="btn btn-primary" (click)="guardar()">ðŸ’¾ Guardar</button>
    </div>
  </div>

  <section class="fila">
    <div class="contenedor">
      <!-- Botones -->
      <label class="stock-indicator" title="Estado de stock">
        <span class="pill" data-stock="true">{{ stock }}</span>
      </label>

      <button
        class="kpi success"
        [class.active]="estadoSeleccionado === 'cubiertos'"    
        (click)="toggleEstado('cubiertos')">
        <span class="badge">âœ”</span> Cubiertos <strong>{{ nUsados }}</strong>
      </button>

      <button
        class="kpi warn"
        [class.active]="estadoSeleccionado === 'noCubiertos'"    
        (click)="toggleEstado('noCubiertos')">
        <span class="badge">âœ–</span> No Cubiertos <strong>{{ nNoUsados }}</strong>        
      </button>
      
      <button
        class="kpi total"
        [class.active]="estadoSeleccionado === 'total'"    
        (click)="toggleEstado('total')">
        <span class="badge">Î£</span> Total <strong>{{ nTotal }}</strong>        
      </button>
    </div>

    <!-- Panel desplegable debajo -->
    <div class="usados-panel" *ngIf="estadoSeleccionado">
      <p>{{ usadosParaMostrar }}</p>
    </div>
  </section>


  <div class="tabs" role="tablist">
    <button class="tab" role="tab" aria-selected="true" data-tab="con">
      Patrones con empate
    </button>
    <button class="tab" role="tab" aria-selected="false" data-tab="sin">
      Patrones sin empate
    </button>
    <button class="tab" role="tab" aria-selected="false" data-tab="res">
      Resultados
    </button>
  </div>

  <section class="card tabpanel" id="panel-sin" role="tabpanel">
    <div class="card-hd">
      Patrones de corte <span class="muted"></span>
    </div>
    <div class="card-bd center muted">
      <app-tabla-analisis
        *ngIf="piezasConEmpate?.length"
        [data]="piezasConEmpate" [proyecto]="proyectoSeleccionado" [lote]="loteSeleccionado"
      ></app-tabla-analisis>
    </div>
  </section>

  <section class="card tabpanel" id="panel-sin" role="tabpanel" hidden>
    <div class="card-hd">Patrones sin empate</div>
    <div class="card-bd center muted">
      <app-tabla-analisis
        *ngIf="piezasSinEmpate?.length"
        [data]="piezasSinEmpate" [proyecto]="proyectoSeleccionado" [lote]="loteSeleccionado"
      ></app-tabla-analisis>
    </div>
  </section>

  <section class="card tabpanel" id="panel-res" role="tabpanel" hidden>
    <div class="card-hd">Resultados</div>
    <div class="card-bd center muted">
      Resumen final del nesting (placeholder).
    </div>
  </section>
</main>
