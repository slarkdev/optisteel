<main class="main">
  <h1 class="page-title">AnÃ¡lisis â€” W_Profiles</h1>
  <p class="subtitle">
    <strong>
      Proyecto: {{ proyectoSeleccionado?.name || "" }} Lote:
      {{ loteSeleccionado?.NombreTrabajo || "" }}</strong
    >
  </p>

  <div class="ctx" style="justify-content: space-between">
    <div>
      <mat-form-field style="width: 20rem">
        <mat-label>Filtro por Perfil</mat-label>
        <mat-select
          [formControl]="perfilesSeleccionados"
          (selectionChange)="buscarDatosConPiezasySinPiezas()"
          multiple
        >
          <mat-option
            (click)="toggleSelectAll($event)"
            [value]="selectAllValue"
          >
            Seleccionar Todo
          </mat-option>

          <mat-select-trigger>
            {{ perfilesSeleccionados.value?.[0]?.Perfil || '' }} -
            {{ perfilesSeleccionados.value?.[0]?.Calidad || '' }}

            @if ((perfilesSeleccionados.value?.length || 0) > 1) {
            <span class="perfiles">
              (+{{ (perfilesSeleccionados.value?.length || 0) - 1 }}
              {{
                perfilesSeleccionados.value?.length === 2 ? "other" : "others"
              }})
            </span>
            }
          </mat-select-trigger>
          @for (perfil of filtroInventarioPiezas; track perfil) {
          <mat-option [value]="perfil"
            >{{ perfil.Perfil }} - {{ perfil.Calidad }}</mat-option
          >
          }
        </mat-select>
      </mat-form-field>

      <button class="btn btn-ghost-1" (click)="ejecutarNesting()">
        ðŸ”„ Ejecutar Nesting
      </button>
    </div>

    <div class="actions">
      <button class="btn btn-ghost-1" (click)="actualizar()">
        ðŸ”„ Actualizar
      </button>
      <button class="btn btn-ghost" (click)="limpiar()">ðŸ§¹ Limpiar</button>
      <button class="btn btn-ghost-1" (click)="exportar()">â¤“ Exportar</button>
      <button class="btn btn-primary" (click)="guardar()">ðŸ’¾ Guardar</button>
    </div>
  </div>

  <section class="fila">
    <div class="contenedor">
      <label class="stock-indicator" title="Estado de stock">
        <span class="pill" data-stock="true">SÃ­ hay stock</span>
      </label>

      <span class="kpi"
        ><span class="badge">âœ”</span> Cubiertos <strong>124</strong></span
      >
      <span class="kpi warn"
        ><span class="badge">âœ–</span> No Cubiertos <strong>18</strong></span
      >
      <span class="kpi"
        ><span class="badge">Î£</span> Total <strong>142</strong></span
      >
    </div>
  </section>

  <div style="display: flex; flex-direction: row">
    <button class="btn btn-ghost" (click)="clickEvent($event)">
      <mat-icon>{{ hide ? "visibility_off" : "visibility" }}</mat-icon> Preview
    </button>
    <div class="tabs" role="tablist">
      <button class="tab" role="tab" aria-selected="true" data-tab="con">
        Patrones con empate
      </button>
      <button class="tab" role="tab" aria-selected="false" data-tab="sin">
        Patrones sin empate
      </button>
      <button class="tab" role="tab" aria-selected="false" data-tab="res">
        Resultados
      </button>
    </div>
  </div>

  <section class="card tabpanel" id="panel-sin" role="tabpanel">
    <div class="card-hd">
      Patrones de corte
      <span class="muted"
        >Â· {{ dataPiezasConEmpate?.length || 0 }} resultados</span
      >
    </div>
    <div class="card-bd center muted">
      <app-tabla-analisis
        *ngIf="dataPiezasConEmpate?.length"
        [data]="dataPiezasConEmpate"
        [proyecto]="proyectoSeleccionado"
        [lote]="loteSeleccionado"
        [hide]="hide"
      ></app-tabla-analisis>
    </div>
  </section>

  <section class="card tabpanel" id="panel-sin" role="tabpanel" hidden>
    <div class="card-hd">Patrones sin empate</div>
    <div class="card-bd center muted">
      <app-tabla-analisis
        *ngIf="dataPiezasSinEmpate?.length"
        [data]="dataPiezasSinEmpate"
        [proyecto]="proyectoSeleccionado"
        [lote]="loteSeleccionado"
        [hide]="hide"
      ></app-tabla-analisis>
    </div>
  </section>

  <section class="card tabpanel" id="panel-res" role="tabpanel" hidden>
    <div class="card-hd">Resultados</div>
    <div class="card-bd center muted">
      Resumen final del nesting (placeholder).
    </div>
  </section>
</main>
