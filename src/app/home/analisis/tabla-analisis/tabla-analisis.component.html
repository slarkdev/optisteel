<!-- <div class="card-bd">
  <div class="section" aria-expanded="true">
    <div class="row expand">
      <svg class="chev" width="14" height="14" viewBox="0 0 24 24">
        <path fill="currentColor" d="m7 10l5 5l5-5H7z" />
      </svg>
      <div class="header-grid" style="flex: 1">
        <div class="h-cell">Proyecto</div>
        <div class="h-cell">Perfil</div>
        <div class="h-cell">Patrón de Corte</div>
        <div class="h-cell">Cantidad</div>
        <div class="h-cell">Piezas</div>
        <div class="h-cell">Saldo (mm)</div>
        <div class="h-cell">Longitud (mm)</div>
        <div class="h-cell">Saldo (%)</div>
        <div class="h-cell">Cortes</div>

        <div>Puente Norte</div>
        <div>W310×39</div>
        <div>W-90-A01</div>
        <div>4</div>
        <div>12</div>
        <div>35</div>
        <div>11000</div>
        <div>2.9%</div>
        <div>9</div>
      </div>
    </div>

    <div class="pattern-bar" style="margin: 6px 0 10px">
      <span class="seg gray" style="left: 0; width: 32%">P1 · 3200mm</span>
      <span class="seg gray" style="left: 32%; width: 36%">P2 · 3600mm</span>
      <span class="seg_hachu gray" style="left: 68%; width: 25%"
        >P3_1 · 3000mm</span
      >
      <span class="seg orange" style="left: 93%; width: 7%"></span>
      <span class="note-right">Saldo +90mm</span>
    </div>

    <div class="detail">
      <div class="detail-head">
        <div>Ref (res nombre)</div>
        <div>Cant</div>
        <div>Cant Total</div>
        <div>Largo (mm)</div>
      </div>
      <div class="detail-row">
        <div>P1</div>
        <div>1</div>
        <div>4</div>
        <div>3200</div>
      </div>
      <div class="detail-row">
        <div>P2</div>
        <div>1</div>
        <div>4</div>
        <div>3600</div>
      </div>
      <div class="detail-row">
        <div>P3_1</div>
        <div>1</div>
        <div>4</div>
        <div>3000</div>
      </div>
      <div class="detail-row">
        <div>Saldo</div>
        <div>—</div>
        <div>—</div>
        <div>1200</div>
      </div>
    </div>
  </div>
</div>
 -->

<div class="card-bd">
  <table
    mat-table
    [dataSource]="dataSource"
    multiTemplateDataRows
    matSort
    style="table-layout: fixed; width: 100%"
  >
    <ng-container matColumnDef="proyecto">
      <th mat-header-cell *matHeaderCellDef style="width: 9rem">Proyecto</th>
      <td mat-cell *matCellDef="let element">
        {{ proyecto.name }} / {{ lote.NombreTrabajo }}
      </td>
    </ng-container>

    <ng-container matColumnDef="perfil">
      <th
        mat-header-cell
        *matHeaderCellDef
        style="width: 12rem"
        mat-sort-header
      >
        Perfil
      </th>
      <td mat-cell *matCellDef="let element">{{ element.Perfil }}</td>
    </ng-container>

    <ng-container matColumnDef="patronCorte">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 8rem">
        Patron de corte
      </th>
      <td mat-cell *matCellDef="let element">{{ element.Item }}</td>
    </ng-container>

    <ng-container matColumnDef="cantidad">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 6rem">
        Cantidad
      </th>
      <td mat-cell *matCellDef="let element">{{ element.Cantidad }}</td>
    </ng-container>

    <ng-container matColumnDef="piezas">
      <th
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        style="width: 15rem"
      >
        Piezas
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [matTooltip]="element.Piezas.length > 30 ? element.Piezas : ''"
        matTooltipPosition="above"
        style="
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 200px;
        "
      >
        {{ element.Piezas }}
      </td>
    </ng-container>

    <ng-container matColumnDef="saldoMM">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 6rem">
        Saldo (mm)
      </th>
      <td mat-cell *matCellDef="let element">{{ element.Merma }}</td>
    </ng-container>

    <ng-container matColumnDef="longitud">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 6rem">
        Longitud (mm)
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element["Longitud Stock Total"] }}
      </td>
    </ng-container>

    <ng-container matColumnDef="saldo%">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 6rem">
        Saldo (%)
      </th>
      <td mat-cell *matCellDef="let element">{{ element["Merma %"] }}</td>
    </ng-container>

    <ng-container matColumnDef="cortes">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 6rem">
        Cortes
      </th>
      <td mat-cell *matCellDef="let element" style="width: 6rem">
        {{ element.Cortes }}
      </td>
    </ng-container>

    <ng-container matColumnDef="expand">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>&nbsp;</th>
      <td mat-cell *matCellDef="let element">
        <button
          matIconButton
          (click)="toggle(element); $event.stopPropagation()"
          class="example-toggle-button"
          [class.example-toggle-button-expanded]="isExpanded(element)"
        >
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="graficoFila">
      <td
        mat-cell
        *matCellDef="let element"
        [attr.colspan]="columnsToDisplayWithExpand.length"
      >
        <div
          *ngIf="
            getSegmentDataFromString(
              element,
              element['Longitud Stock Total']
            ) as segmentos
          "
          style="
            display: flex;
            height: 30px;
            width: 100%;
            border: 1px solid #ccc;
            margin-top: 8px;
          "
        >
          <div
            *ngFor="let seg of segmentos"
            [style.width.%]="seg.width"
            [ngClass]="seg.clase"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 12px;
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
              padding: 0 4px;
              min-width: 8px;
              pointer-events: auto;
            "
            [matTooltip]="seg.label + ': ' + seg.width.toFixed(1) + '%'"
            matTooltipPosition="above"
          >
            {{ seg.width > 10 ? seg.label : "" }}
          </div>
        </div>
      </td>
    </ng-container>

    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
    <ng-container matColumnDef="expandedDetail">
      <td
        mat-cell
        *matCellDef="let element"
        [attr.colspan]="columnsToDisplayWithExpand.length"
      >
        <div
          class="example-element-detail-wrapper"
          [class.example-element-detail-wrapper-expanded]="isExpanded(element)"
        >
          <div class="example-element-detail">
            <table
              mat-table
              [dataSource]="element.detalleExpandido"
              class="tabla-detalle"
              style="width: 100%; border-collapse: collapse"
            >
              <!-- Columna: Código -->
              <ng-container matColumnDef="nombrePieza">
                <th mat-header-cell *matHeaderCellDef>Ref (res nombre)</th>
                <td mat-cell *matCellDef="let row">{{ row.nombrePieza }}</td>
              </ng-container>

              <ng-container matColumnDef="cantidad">
                <th mat-header-cell *matHeaderCellDef>Cant</th>
                <td mat-cell *matCellDef="let row">{{ row.cantidad }}</td>
              </ng-container>

              <ng-container matColumnDef="cantidadTotal">
                <th mat-header-cell *matHeaderCellDef>Cant Total</th>
                <td mat-cell *matCellDef="let row">{{ row.cantidadTotal }}</td>
              </ng-container>

              <ng-container matColumnDef="largo">
                <th mat-header-cell *matHeaderCellDef>Largo (mm)</th>
                <td mat-cell *matCellDef="let row">{{ row.largo }}</td>
              </ng-container>

              <ng-container matColumnDef="subTotal">
                <th mat-header-cell *matHeaderCellDef>SubTotal (mm)</th>
                <td mat-cell *matCellDef="let row">{{ row.subTotal }}</td>
              </ng-container>

              <!-- Filas -->
              <tr mat-header-row *matHeaderRowDef="subColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: subColumns"></tr>
            </table>
          </div>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
    <tr
      mat-row
      matRipple
      *matRowDef="let element; columns: columnsToDisplayWithExpand"
      class="example-element-row"
      [class.example-expanded-row]="isExpanded(element)"
      (click)="toggle(element)"
    ></tr>

    <!-- Fila secundaria fija debajo -->
    <ng-container *ngIf="!hide">
      <tr mat-row *matRowDef="let row; columns: ['graficoFila']"></tr>
    </ng-container>

    <ng-container *ngIf="!hide">
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']"></tr>
    </ng-container>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
  </mat-paginator>
</div>

<!-- ojo esta parte no sabemos donde va -->
<div class="grid3">
  <div class="stat">
    <h4>Saldos</h4>
    <div class="kline"><span>Saldo total (mm)</span><strong>620</strong></div>
    <div class="kline"><span>Saldo / series</span><strong>1.9%</strong></div>
    <div class="kline">
      <span>Resto utilizable (mm)</span><strong>180</strong>
    </div>
  </div>
  <div class="stat">
    <h4>Postprocesado</h4>
    <div class="kline"><span>Despiece</span><strong>0.6%</strong></div>
    <div class="kline"><span># Barras utilizadas</span><strong>14</strong></div>
    <div class="kline"><span># Cortes</span><strong>35</strong></div>
  </div>
  <div class="stat">
    <h4>Resumen</h4>
    <div class="kline"><span>Empates</span><strong>2</strong></div>
    <div class="kline"><span>Perfiles W Series</span><strong>16</strong></div>
    <div class="kline"><span>Patrones</span><strong>10</strong></div>
    <div class="kline"><span>Piezas</span><strong>48</strong></div>
  </div>
</div>
